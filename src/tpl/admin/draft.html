{include file="header.html"}{include file="banner.html"}

<div id="page-wrapper">
    <div class="container-fluid">
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h3>Draft</h3>
                    <div class="clearfix col-pad-bottom-20"></div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-8">
                    Ini adalah halaman untuk menulis kiriman<br>
                    masing masing penulis hanya melihat kiriman miliknya sendiri<br>
                    kiriman yang telah selesai akan disubmit kepada redaksi untuk diperiksa.
                </div>
                <div class="col-md-4 text-right">
                    <a href="#editor-link" class="btn btn-primary btn-menu" data-id="">Baru</a>
                </div>
            </div>
            {foreach $draft as $key=>$val}
            <hr>
            <div class="row">
                <div class="col-md-5">
                    <small>
                        <span class="text-primary">
                            <small class="text-muted"><strong>{$val['menu_nama']}</strong></small><br>
                            {$val['tgl']} - {$val['jam']} <br>
                        </span> 
                    </small>
                    <strong>{$val['judul']}</strong>
                </div>
                <div class="col-md-2 text-right">
                    {if $val['status']=='1'} 
                        <span class="text-primary">Saved</span> 
                    {elseif $val['status']=='2'}
                        <span class="text-success">Submitted</span> 
                    {else}
                        <span class="text-danger">Rejected</span> 
                    {/if}
                </div>
                <div class="col-md-5 text-right">
                    {if $val['status'] == '1'}
                    <a href="#" class="btn btn-primary btn-submit" data-id="{$val['id']}">Submit</a> 
                    {/if}
                    {if $val['status']!='2'}
                    <a href="#" class="btn btn-success btn-menu" data-id="{$val['id']}">Edit</a> 
                    <a href="#" class="btn btn-danger btn-delete" data-id="{$val['id']}">Hapus</a> 
                    {/if}
                </div>
                               
                             
            </div>
            {/foreach}              
            <br>
            <div class="row">
                <div class="col-md-12 col-pad-bottom-10 form-editor"></div>
                <div class="col-md-12 col-pad-bottom-10 form-editor">
                    <form name="draft-editor" class="form" role="form" method="post" action="{$url}">
                        <div id="draft-editor"></div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            {include file="mboard.html"}
        </div>
    </div>
</div>


<div class="modal fade" id="cropit-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
    <form id="image-upload"><!-- method="post" enctype="multipart/form-data">-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title text-center text-muted" id="myModalLabel">Upload Image</h4>
            </div>
            <div class="modal-body image-editor">
                <input type="file" class="cropit-image-input">
                <div class="cropit-preview img-responsive">
                    <span class="glyphicon glyphicon-picture icon-bg"></span>
                </div>
                <div class="image-size-label">
                    Resize image
                </div>
                <input type="range" class="cropit-image-zoom-input form-control">
                <input type="hidden" name="image-data" id="image-data">
                <input type="hidden" name="submit" value="dummy-submit">
                <small>
                <span class="text-info"><em>Ukuran foto min : 640x480(300k) dan max : 1600x1200(2m)</em></span>
                </small>    
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <input type="submit" class="btn btn-primary" name="upload" value="Upload">
            </div>
            </form>
        </div>
    </div>
</div>
<form name="form-hidden" id="form-hidden" method="post">
    <input type="hidden" name="id" id="hidden-id">
    <input type="submit" name="submit" value="submit" id="hidden-submit" class="hidden">
</form>

<script src="{$js}/jquery.cropit.js"></script>
<script src="{$js}/tinymce.min.js"></script>
<script>
    $(function () {
        $('.btn-menu').click(
            function (e) {
                e.preventDefault();
                var a = $(this).attr('data-id');
                $.get('{$hta}ajax/getdraft/'+a, function(d){
                    $('#draft-editor').html(d);
                    var  o = $('a[name="editor-link"]');  
                });    
            });
        $('.btn-submit').click( 
            function(e){
                e.preventDefault();
                var a = $(this).attr('data-id');
                $('#form-hidden').attr('action','{$hta}admin/sendsubmit');
                $('#hidden-id').val(a);
                $('#hidden-submit').click();
            }); 

        $('.btn-delete').click(
            function(e){
                e.preventDefault();
                var a = $(this).attr('data-id');
                $('#form-hidden').attr('action','{$hta}admin/senddelete');
                $('#hidden-id').val(a);
                $('#hidden-submit').click();
            }); 

        $('.upload-image').on('click', function(e){
            e.preventDefault();
        });
        $('.image-editor').cropit({
            imageBackground: true, 
            imageBackgroundBorderWidth: 30, 
        });
    });
     $('#image-upload').unbind().submit( function(){
            var imageData = $('.image-editor').cropit('export', {
                type: 'image/jpeg',
                quality: 1,
                originalSize: true,
            });
            $('#image-data').val(imageData);
            var formValue = $(this).serialize();
            $.ajax({
                type:'post',
                data:formValue,
                url:'{$hta}image/post/jpg',
                success: function(d){
                    var f='{$hta}image/'+d+'/320';
                    $('#img-file').val(d);
                    $('#img-display').attr('src',f);                    
                    $('#cropit-dialog').modal('hide');   
                }
            });
            return false;
        });
</script>
{include file="footer.html"}