{include file="header.html"}{include file="banner.html"}

<div id="page-wrapper">
    <div class="container-fluid">
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h3>Submitted Draft</h3>
                    
                    
                    
                    <div class="clearfix col-pad-bottom-20"></div>
                </div>
            </div>
                    
            <div class="row">
                <div class="col-md-12">
                    Halaman ini adalah halaman untuk redaksi,<br>
                    memeriksa kiriman,<br> 
                    merilis bila memenuhi syarat atau menolak.<br>
                    bila ditolak, kiriman dikembalikan ke draft untuk diperbaiki atau dihapus oleh pengirim..<br><br>
                    <small class="text-muted"><em>*Untuk Rilis atau Tolak silahkan Klik Eval</em></small>
                </div>
                
            </div>
            {foreach $draft as $key=>$val}
            <hr>
            <div class="row">
                
                <div class="col-md-8">
                    <small>
                        <span class="text-primary"> 
                            <small class="text-muted"><strong>{$val['menu_nama']}</strong></small><br>
                            {$val['author_nick']}<br>
                            {$val['tgl']} - {$val['jam']}<br>
                        </span>
                    </small> 
                    <strong>{$val['judul']} </strong>
                </div>
                
                <div class="col-md-4 text-right">
                    <a href="#" class="btn btn-success btn-eval" data-id="{$val['id']}">Eval</a> 
                    <a href="#" class="btn btn-primary btn-menu" data-id="{$val['id']}">Edit</a> 
                </div>
            </div>
            {/foreach}             
            <br>
            <div class="row">
                <div class="col-md-12 col-pad-bottom-10 form-editor"></div>
                <div class="col-md-12 col-pad-bottom-10 form-editor">
                    <form name="draft-editor" class="form" role="form" method="post" action="{$url}">
                        <div id="draft-editor"></div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            {include file="mboard.html"}
        </div>
    </div>
</div>


<div class="modal fade" id="cropit-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
    <form id="image-upload"><!-- method="post" enctype="multipart/form-data">-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title text-center text-muted" id="myModalLabel">Upload Image</h4>
            </div>
            <div class="modal-body image-editor">
                <input type="file" class="cropit-image-input">
                <div class="cropit-preview img-responsive">
                    <span class="glyphicon glyphicon-picture icon-bg"></span>
                </div>
                <div class="image-size-label">
                    Resize image
                </div>
                <input type="range" class="cropit-image-zoom-input form-control">
                <input type="hidden" name="image-data" id="image-data">
                <input type="hidden" name="submit" value="dummy-submit">
                <small>
                <span class="text-info"><em>Ukuran foto min : 640x480(300k) dan max : 1600x1200(2m)</em></span>
                </small>    
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <input type="submit" class="btn btn-primary" name="upload" value="Upload">
            </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="draft-eval" tabindex="-1" role="dialog" aria-labelledby="eval-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="eval-label">Evaluasi</h4>
      </div>
        <form id="form-eval" id="form-eval" method="post">
      <div class="modal-body" id="eval-content">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-danger btn-eval-option" data-ur="sendreject">Tolak dan Kembalikan</button>  
        <button type="button" class="btn btn-primary btn-eval-option" data-ur="sendaccept">Rilis Sekarang</button>
      </div>
            <input type="submit" id="submit-eval-form" name="submit" value="submit" class="hidden">
        </form>    
    </div>
  </div>
</div>

<script src="{$js}/jquery.cropit.js"></script>
<script src="{$js}/tinymce.min.js"></script>
<script>
    $(function () {
        $('.btn-eval').click( 
            function(e){
                e.preventDefault();
                var a = $(this).attr('data-id');
                $.get('{$hta}ajax/evaldraft/'+a, function(d){
                    $('#eval-content').html(d);  
                    $('#draft-eval').modal();
                });
            });
        $('.btn-eval-option').click(
            function(e){
                e.preventDefault();
                var u=$(this).attr('data-ur');
                $('#form-eval').attr('action','{$hta}admin/'+u);
                $('#submit-eval-form').click();
            });
        $('.btn-menu').click(
            function (e) {
                e.preventDefault();
                var a = $(this).attr('data-id');
                $.get('{$hta}ajax/getdraft/'+a, function(d){
                    $('#draft-editor').html(d);
                    var  o = $('a[name="editor-link"]');  
                });    
            });
        $('.btn-submit').click( 
            function(e){
                e.preventDefault();
                var a = $(this).attr('data-id');
                $.post('{$hta}admin/sendsubmit',{  id: a,  submit:'submit' }
                   , function(){   
                    window.location.reload();
                });
            }); 
        $('.btn-delete').click(
            function(e){
                e.preventDefault();
                var a = $(this).attr('data-id');
                $.post('{$hta}admin/senddelete',{  id: a,  submit:'submit' }
                   , function(){  
                    window.location.reload();
                });
            });
        $('.upload-image').on('click', function(e){
            e.preventDefault();
        });
        $('.image-editor').cropit({
            imageBackground: true, 
            imageBackgroundBorderWidth: 30, 
        });
    });
     $('#image-upload').unbind().submit( function(){
            var imageData = $('.image-editor').cropit('export', {
                type: 'image/jpeg',
                quality: 1,
                originalSize: true,
            });
            $('#image-data').val(imageData);
            var formValue = $(this).serialize();
            $.ajax({
                type:'post',
                data:formValue,
                url:'{$hta}image/post/jpg',
                success: function(d){
                    var f='{$hta}image/'+d+'/320';
                    $('#img-file').val(d);
                    $('#img-display').attr('src',f);                    
                    $('#cropit-dialog').modal('hide');   
                }
            });
            return false;
        });
</script>
{include file="footer.html"}

